---
title: MySQL干货
tags:
  - 学而时习之
  - MySQL
categories:
  - 学而时习之
abbrlink: ae30601a
date: 2024-01-12 20:28:54
description:
---

#### `1. SQL的分类`

##### DDL语句：

数据定义语句（Data Define Language），例如：创建（create），修改（alter），删除（drop）等

##### DML语句：

数据操作语句，例如：增（insert)，删（delete），改（update），查（select）

##### DQL语句：

因为查询语句使用的非常的频繁，所以很多人把查询语句单拎出来一类，DQL（数据查询语言），DR（获取）L

##### DCL语句：

数据控制语句，例如：grant，commit，rollback等

其他语句：USE语句，SHOW语句，SET语句等。这类的官方文档中一般称为命令。

#### 2 .SQL语法规范

#### （1）mysql的sql语法不区分大小写

A：数据库的`表中的数据是否区分大小写`。这个的话要看表格的字段的数据类型、编码方式以及校对规则。

`ci（大小写不敏感），cs（大小写敏感），_bin（二元，即比较是基于字符编码的值而与language无关，区分大小写）`

B：sql中的关键字，比如：create,insert等，不区分大小写。但是大家习惯上把关键字都“大写”。

#### （3）关键字

建议不要使用mysql的关键字等来作为表名、字段名、数据库名等，如果不小心使用，请`在SQL语句中使用`（飘号）引起来`

建议不要使用mysql的关键字等来作为表名、字段名、数据库名等，如果`不小心使用，请在SQL语句中使用（飘号）引起来`

#### SQL脚本中如何加注释

SQL脚本中如何加注释

##### 1.单行注释：

#注释内容（mysql特有的）

##### 2.单行注释：

--空格注释内容    其中--后面的空格必须有

##### 3.多行注释：

/_ 注释内容 _/

```
create table tt(
	id int, #编号
    `name` varchar(20), -- 姓名
    gender enum('男','女')
    /*
    性别只能从男或女中选择一个，
    不能两个都选，或者选择男和女之外的
    */
);
```

##### 单引号''：

`字符串和日期类型的数据值使用单引号''引起来`

##### 双引号""：

`列的别名可以使用双引号""，给表名取别名不要使用双引号。`

在当前select语句中给某个字段或表达式计算结果，或表等取个临时名称，便于当前select语句的编写和理解。这个临时名称称为别名。

```
select 字段名1 as "别名1", 字段名2 as "别名2" from 表名称 as 别名;
```

- `列的别名有空格时，请加双引号。列的别名中没有空格时，双引号可以加也可以不加。`     

- `表的别名不能加双引号，表的别名中间不能包含空格。`
- `as大小写都可以，as也完全可以省略。`

#### 3. 结果去重

`mysql可以在查询结果中使用distinct关键字去重。`

注意Java中判断用==，mysql判断用=

`#mysql中只要有null值参与运算和比较，结果就是null，底层就是0，表示条件不成立。`

能用于null判断：

`is null ,is not null`

`“<=>”的意思为“安全等于”，能比较null`

区间范围：between x  and  y
	    not between x  and  y
集合范围：in (x,x,x)
	    not  in(x,x,x)

#查询当前mysql数据库的字符集情况
show variables like '%character%';

逻辑异或： xor  只能满足其一

6.关于null值的问题（掌握）

#(2)计算时
ifnull(xx,代替值)  当xx是null时，用代替值计算

- `分组函数：或者又称为聚合函数，多行函数`，表示会对表中的多行记录一起做一个“运算”，得到一个结果。
  - 求平均值的avg，求最大值的max，求最小值的min，求总和sum，求个数的count等
- 单行函数：表示会对表中的每一行记录分别计算，有n行得到还是n行结果
  - `数学函数`、字符串函数、日期时间函数、条件判断函数、窗口函数等

count(*)或`count(常量值)：都是统计实际的行数。`

count(字段/表达式)：只统计“字段/表达式”部分非NULL值的行数。

#### 2 .单行函数（了解，用的时候查，太多了，演示一小部分）

调用完函数后，记录数不变，一行计算完之后还是一行。

##### 1、数学函数

以下表格中也只是列出了一部分

| 函数              | 用法                                                         |
| ----------------- | ------------------------------------------------------------ |
| ABS(x)            | 返回x的绝对值                                                |
| CEIL(x)           | 返回大于x的最小整数值                                        |
| FLOOR(x)          | 返回小于x的最大整数值                                        |
| MOD(x,y)          | 返回x/y的模                                                  |
| ==RAND()==        | 返回0~1的随机值                                              |
| ==ROUND(x,y)==    | 返回参数x的四舍五入的有y位的小数的值                         |
| ==TRUNCATE(x,y)== | 返回数字x截断为y位小数的结果                                 |
| ==FORMAT(x,y)==   | ==强制保留小数点后y位，整数部分超过三位的时候以逗号分割，并且返回的结果是文本类型的== |
| SQRT(x)           | 返回x的平方根                                                |
| POW(x,y)          | 返回x的y次方                                                 |



##### 字符串函数

下面列出部分字符串函数：

| 函数                                                         | 功能描述                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| CONCAT(S1,S2,……Sn)                                           | 连接S1,S2,……Sn为一个字符串                                   |
| CONCAT_WS(s,S1,S2,……Sn)                                      | 同CONCAT(S1,S2,…)函数，但每个字符串之间要加上s               |
| CHAR_LENGTH(s)                                               | 返回字符串s的字符数                                          |
| LENGTH(s)                                                    | 返回字符串s的字节数，和字符集有关                            |
| LOCATE(str1,str)或  POSITION(str1 in str)或  INSTR(str,str1) | 返回子字符串str1在str中的开始位置                            |
| UPPER(s)或UCASE(s)                                           | 将字符串s的所有字母转成大写字母                              |
| LOWER(s)或LCASE(s)                                           | 将字符串s的所有字母转成小写字母                              |
| LEFT(s,n)                                                    | 返回字符串s最左边的n个字符                                   |
| RIGHT(s,n)                                                   | 返回字符串s最右边的n个字符                                   |
| LPAD(str,len,pad)                                            | 用字符串pad对str最左边进行填充直到str的长度达到len           |
| RPAD(str,len,pad)                                            | 用字符串pad对str最右边进行填充直到str的长度达到len           |
| LTRIM(s)                                                     | 去掉字符串s左侧的空格                                        |
| RTRIM(s)                                                     | 去掉字符串s右侧的空格                                        |
| TRIM(s)                                                      | 去掉字符串s开始与结尾的空格                                  |
| TRIM([BOTH] s1 FROM s)                                       | 去掉字符串s开始与结尾的s1                                    |
| TRIM([LEADING] s1 FROM s)                                    | 去掉字符串s开始处的s1                                        |
| TRIM([TRAILING]s1 FROM s)                                    | 去掉字符串s结尾处的s1                                        |
| INSERT(str,index,len,instr)                                  | 将字符串str从index位置开始len个字符的替换为字符串instr       |
| REPLACE(str,a,b)                                             | 用字符串b替换字符串str中所有出现的字符串a                    |
| REPEAT(str,n)                                                | 返回str重复n次的结果                                         |
| REVERSE(s)                                                   | 将字符串反转                                                 |
| STRCMP(s1,s2)                                                | 比较字符串s1,s2                                              |
| SUBSTRING(s,index,len)                                       | 返回从字符串s的index位置截取len个字符                        |
| SUBSTRING_INDEX(str, 分隔符，count)                          | 如果count是正数，那么从左往右数，第n个分隔符的左边的全部内容。例如，substring_index("www.atguigu.com",".",1)是"www"。如果count是负数，那么从右边开始数，第n个分隔符右边的所有内容。例如，substring_index("www.atguigu.com",".",-1)是"com"。 |

##### 日期时间函数

| 函数                                                         | 功能描述                                            |
| ------------------------------------------------------------ | --------------------------------------------------- |
| CURDATE()或CURRENT_DATE()                                    | 返回当前系统日期                                    |
| CURTIME()或CURRENT_TIME()                                    | 返回当前系统时间                                    |
| NOW()/SYSDATE()/CURRENT_TIMESTAMP()/  LOCALTIME()/LOCALTIMESTAMP() | 返回当前系统日期时间                                |
| UTC_DATE()/UTC_TIME()                                        | 返回当前UTC日期值/时间值                            |
| UNIX_TIMESTAMP(date)                                         | 返回一个UNIX时间戳                                  |
| YEAR(date)/MONTH(date)/DAY(date)/  HOUR(time)/MINUTE(time)/SECOND(time) | 返回具体的时间值                                    |
| EXTRACT(type FROM date)                                      | 从日期中提取一部分值                                |
| DAYOFMONTH(date)/DAYOFYEAR(date)                             | 返回一月/年中第几天                                 |
| WEEK(date)/WEEKOFYEAR(date)                                  | 返回一年中的第几周                                  |
| DAYOFWEEK()                                                  | 返回周几，注意，周日是1，周一是2，…周六是7          |
| WEEKDAY(date)                                                | 返回周几，注意，周一是0，周二是1，…周日是6          |
| DAYNAME(date)                                                | 返回星期，MONDAY,TUESDAY,…SUNDAY                    |
| MONTHNAME(date)                                              | 返回月份，January,…                                 |
| DATEDIFF(date1,date2)/TIMEDIFF(time1,time2)                  | 返回date1-date2的日期间隔/返回time1-time2的时间间隔 |
| DATE_ADD(date,INTERVAL expr type)或ADDDATE/DATE_SUB/SUBDATE  | 返回与给定日期相差INTERVAL时间段的日期              |
| ADDTIME(time,expr)/SUBTIME(time,expr)                        | 返回给定时间加上/减去expr的时间值                   |
| DATE_FORMAT(datetime,fmt)/  TIME_FORMAT(time,fmt)            | 按照字符串fmt格式化日期datetime值/时间time值        |
| STR_TO_DATE(str,fmt)                                         | 按照字符串fmt对str进行解析，解析为一个日期          |
| GET_FORMAT(val_type,format_type)                             | 返回日期时间字符串的显示格式                        |

函数中format参数说明

| 格式符 | 说明                                                      | 格式符 | 说明                                                    |
| ------ | --------------------------------------------------------- | ------ | ------------------------------------------------------- |
| %Y     | 4位数字表示年份                                           | %y     | 两位数字表示年份                                        |
| %M     | 月名表示月份（January,…）                                 | %m     | 两位数字表示月份（01,02,03，…）                         |
| %b     | 缩写的月名（Jan.,Feb.,…）                                 | %c     | 数字表示月份（1,2,3…）                                  |
| %D     | 英文后缀表示月中的天数（1st,2nd,3rd,…）                   | %d     | 两位数字表示表示月中的天数（01,02,…）                   |
| %e     | 数字形式表示月中的天数（1,2,3,…）                         | %p     | AM或PM                                                  |
| %H     | 两位数字表示小数，24小时制（01,02,03,…）                  | %h和%I | 两位数字表示小时，12小时制（01,02,03,…）                |
| %k     | 数字形式的小时，24小时制（1,2,3,…）                       | %l     | 数字表示小时，12小时制（1,2,3,…）                       |
| %i     | 两位数字表示分钟（00,01,02,…）                            | %S和%s | 两位数字表示秒（00,01,02,…）                            |
| %T     | 时间，24小时制（hh:mm:ss）                                | %r     | 时间，12小时制（hh:mm:ss）后加AM或PM                    |
| %W     | 一周中的星期名称（Sunday,…）                              | %a     | 一周中的星期缩写（Sun.,Mon.,Tues.,…）                   |
| %w     | 以数字表示周中的天数（0=Sunday,1=Monday,…）               | %j     | 以3位数字表示年中的天数（001,002,…）                    |
| %U     | 以数字表示的的第几周（1,2,3,…）  其中Sunday为周中的第一天 | %u     | 以数字表示年中的年份（1,2,3,…）  其中Monday为周中第一天 |
| %V     | 一年中第几周（01~53），周日为每周的第一天，和%X同时使用   | %X     | 4位数形式表示该周的年份，周日为每周第一天，和%V同时使用 |
| %v     | 一年中第几周（01~53），周一为每周的第一天，和%x同时使用   | %x     | 4位数形式表示该周的年份，周一为每周第一天，和%v同时使用 |
| %%     | 表示%                                                     |        |                                                         |


GET_FORMAT函数中val_type 和format_type参数说明

| 值类型   | 格式化类型 | 显示格式字符串    |
| -------- | ---------- | ----------------- |
| DATE     | EUR        | %d.%m.%Y          |
| DATE     | INTERVAL   | %Y%m%d            |
| DATE     | ISO        | %Y-%m-%d          |
| DATE     | JIS        | %Y-%m-%d          |
| DATE     | USA        | %m.%d.%Y          |
| TIME     | EUR        | %H.%i.%s          |
| TIME     | INTERVAL   | %H%i%s            |
| TIME     | ISO        | %H:%i:%s          |
| TIME     | JIS        | %H:%i:%s          |
| TIME     | USA        | %h:%i:%s %p       |
| DATETIME | EUR        | %Y-%m-%d %H.%i.%s |
| DATETIME | INTERVAL   | %Y%m%d %H%i%s     |
| DATETIME | ISO        | %Y-%m-%d %H:%i:%s |
| DATETIME | JIS        | %Y-%m-%d %H:%i:%s |
| DATETIME | USA        | %Y-%m-%d %H.%i.%s |

#日期时间函数
/*
获取系统日期时间值
获取某个日期或时间中的具体的年、月等值
获取星期、月份值，可以是当天的星期、当月的月份
获取一年中的第几个星期，一年的第几天
计算两个日期时间的间隔
获取一个日期或时间间隔一定时间后的另个日期或时间
和字符串之间的转换
*/
#（1）获取系统日期。CURDATE（）和CURRENT_DATE（）函数都可以获取当前系统日期。将日期值“+0”会怎么样？
SELECT CURDATE(),CURRENT_DATE();

#（2）获取系统时间。CURTIME（）和CURRENT_TIME（）函数都可以获取当前系统时间。将时间值“+0”会怎么样？
SELECT CURTIME(),CURRENT_TIME();

#（3）获取系统日期时间值。CURRENT_TIMESTAMP（）、LOCALTIME（）、SYSDATE（）和NOW（）
SELECT CURRENT_TIMESTAMP(),LOCALTIME(),SYSDATE(),NOW();

#（4）获取当前UTC（世界标准时间）日期或时间值。
#本地时间是根据地球上不同时区所处的位置调整 UTC 得来的，
#例如，北京时间比UTC时间晚8个小时。
#UTC_DATE(),CURDATE(),UTC_TIME(), CURTIME()
SELECT UTC_DATE(),CURDATE(),UTC_TIME(), CURTIME();


#（5）获取UNIX时间戳。
SELECT UNIX_TIMESTAMP(),UNIX_TIMESTAMP('2022-1-1');

#（6）获取具体的时间值，比如年、月、日、时、分、秒。
#分别是YEAR（date）、MONTH（date）、DAY（date）、HOUR（time）、MINUTE（time）、SECOND（time）。
SELECT YEAR(CURDATE()),MONTH(CURDATE()),DAY(CURDATE());
SELECT HOUR(CURTIME()),MINUTE(CURTIME()),SECOND(CURTIME());


#（7）获取日期时间的指定值。EXTRACT（type FROM date/time）函数
SELECT EXTRACT(YEAR_MONTH FROM CURDATE());

#（8）获取两个日期或时间之间的间隔。
#DATEDIFF（date1，date2）函数表示返回两个日期之间间隔的天数。
#TIMEDIFF（time1，time2）函数表示返回两个时间之间间隔的时分秒。

#查询今天距离员工入职的日期间隔天数
SELECT ename,DATEDIFF(CURDATE(),hiredate) FROM t_employee;

#查询现在距离中午放学还有多少时间
SELECT TIMEDIFF(CURTIME(),'12:0:0');

#（9）在“t_employee”表中查询本月生日的员工姓名、生日。
SELECT ename,birthday
FROM t_employee
WHERE MONTH(CURDATE()) = MONTH(birthday);

#(10)#查询入职时间超过5年的
SELECT ename,hiredate,DATEDIFF(CURDATE(),hiredate) 
FROM t_employee
WHERE DATEDIFF(CURDATE(),hiredate)  > 365*5;

#### 加密函数

#### #其他函数

SELECT USER();
SELECT VERSION();
SELECT DATABASE(); 

| database() | 返回当前数据库名   |
| :--------- | :----------------- |
| version()  | 返回当前数据库版本 |
| user()     | 返回当前登录用户名 |

##### 6、条件判断函数

| 函数                                                         | 功能                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| IF(value,t,f)                                                | 如果value是真，返回t,否则返回f                               |
| ==IFNULL(value1,value2)==                                    | ==如果value1不为空，返回value1,否则返回value2==              |
| ==CASE WHEN 条件1  THEN result1 WHEN 条件2  THEN result2 … ELSE resultn END== | ==依次判断条件，哪个条件满足了，就返回对应的result,所有条件都不满足就返回ELSE的result。如果没有单独的ELSE子句，当所有WHEN后面的条件都不满足时则返回NULL值结果。等价于Java中if...else if....== |
| ==CASE expr WHEN 常量值1  THEN 值1  WHEN 常量值2  THEN 值2 …  ELSE 值n END== | ==判断表达式expr与哪个常量值匹配，找到匹配的就返回对应值，都不匹配就返回ELSE的值。如果没有单独的ELSE子句，当所有WHEN后面的常量值都不匹配时则返回NULL值结果。等价于Java中switch....case== |

#### 3 .窗口函数

窗口函数也叫OLAP函数（Online Anallytical Processing，联机分析处理），可以对数据进行实时分析处理。窗口函数是每条记录都会分析，有几条记录执行完还是几条，因此也属于单行函数。

| 函数分类 | 函数                 | 功能描述                                                     |
| -------- | -------------------- | ------------------------------------------------------------ |
| 序号函数 | ==ROW_NUMBER()==     | 顺序排序，每行按照不同的分组逐行编号，例如：1,2,3,4          |
|          | RANK()               | 并列排序，每行按照不同的分组进行编号，同一个分组中排序字段值出现重复值时，并列排序并跳过重复序号，例如：1,1,3 |
|          | ==DENSE_RANK()==     | 并列排序，每行按照不同的分组进行编号，同一个分组中排序字段值出现重复值时，并列排序不跳过重复序号，例如：1,1,2 |
| 分布函数 | PERCENT_RANK()       | 排名百分比，每行按照公式（rank-1）/ （rows-1）进行计算。其中，rank为RANK()函数产生的序号，rows为当前窗口的记录总行数 |
|          | CUME_DIST()          | 累积分布值，表示每行按照当前分组内小于等于当前rank值的行数 / 分组内总行数 |
| 前后函数 | LAG（expr，n）       | 返回位于当前行的前n行的expr值                                |
|          | LEAD（expr，n）      | 返回位于当前行的后n行的expr值                                |
| 首尾函数 | FIRST_VALUE（expr）  | 返回当前分组第一行的expr值                                   |
|          | LAST_VALUE（expr）   | 返回当前分组每一个rank最后一行的expr值                       |
| 其他函数 | NTH_VALUE（expr，n） | 返回当前分组第n行的expr值                                    |
|          | NTILE（n）           | 用于将分区中的有序数据分为n个等级，记录等级数                |


窗口函数的语法格式如下

```
函数名([参数列表]) OVER ()
函数名([参数列表]) OVER (子句)
```

### 关联查询结果7种情况

![A∩B.png](http://cdn.this0.com/blog/img/1681670563481-8f06d4d6-43f2-445b-83ce-71bc1cd3a473.png)

![A表.png](http://cdn.this0.com/blog/img/1681670563475-fa02c487-e7de-486e-9c15-f80cbebe9c47.png)

![A表-（A∩B）.png](http://cdn.this0.com/blog/img/1681670563483-73e1c3e0-c04c-40a3-b16e-f6959d1bf869.png?OSSAccessKeyId=LTAI5tAje5MhbPSKCC6QdGZb&Expires=9000000000&Signature=9XQ520XPnpsB0fbEXg3zdGI5EiQ=&x-oss-process=style/cdn.this0)

![B表.png](http://cdn.this0.com/blog/img/1681670564753-8cf3a5e0-36b4-4691-a34b-4a5feaa017db.png?OSSAccessKeyId=LTAI5tAje5MhbPSKCC6QdGZb&Expires=9000000001&Signature=b8IKAzGC3YfaaCl7tPyl8Ku2mAw=&x-oss-process=style/cdn.this0)

![B表-（A∩B）.png](http://cdn.this0.com/blog/img/1681670564728-fb7ba6bd-fe42-41eb-8751-cf9c4914c1c8.png?OSSAccessKeyId=LTAI5tAje5MhbPSKCC6QdGZb&Expires=9000000001&Signature=VvhuvtofTEethmMhvDtyToiYjqU=&x-oss-process=style/cdn.this0)

union合并时要注意：
两个表要查询的结果字段是一样的

![A表∪B表.png](http://cdn.this0.com/blog/img/1681670563526-4bdd7f01-ae0b-4004-b87f-1d01d7a22e1a.png?OSSAccessKeyId=LTAI5tAje5MhbPSKCC6QdGZb&Expires=9000000000&Signature=uQjAks9uAbIEl9ERFTLaAhKF7v4=&x-oss-process=style/cdn.this0)

![（A表∪B表）-（A∩B）.png](https://yuling-1318764606.cos.ap-chengdu.myqcloud.com/blog/1681670563480-52986aca-cb45-424a-b4f5-4b1203c9afb7.png)

自连接

```mysql
#查询每一个员工自己的编号、名字、薪资和他的领导的编号、姓名、薪资。
SELECT emp.eid,emp.ename,emp.salary,  mgr.eid,mgr.ename,mgr.salary
FROM t_employee AS emp INNER JOIN t_employee AS mgr
ON emp.mid = mgr.eid; 
#把t_employee当成两张表，通过取别名的方式
#t_employee AS emp 把员工表 当成员工表
# t_employee AS mgr 把员工表  当成存储领导信息的领导表
#emp.mid = mgr.eid; 员工表的领导编号就是领导表的员工编号
```

### 第9章 select的7大子句

#### 1 .7大子句顺序

##### （1）from：从哪些表中筛选

##### （2）`on：关联多表查询时，去除笛卡尔积`

##### （3）where：从表中筛选的条件

##### （4）group by：分组依据

##### （5）having：在统计结果中再次筛选（with rollup)

##### （6）order by：排序

##### （7）limit：分页

`必须按照（1）-（7）的顺序编写子句。`

WITH ROLLUP;//TODO

`根据SQL的语法规则，在使用GROUP BY子句时，SELECT列表中的非聚合列（在这种情况下是eid, ename, did）必须在GROUP BY子句中列出或者是聚合函数的参数。`

`where的条件是针对原表中的记录的筛选。where后面不能出现分组函数。`

`limit m,n`
`n：表示最多该页显示几行`
`m：表示从第几行开始取记录，第一个行的索引是0`
`m = (page-1)*n  page表示第几页`

有很多######################表示TODO

SELECT中的EXISTS型子查询

`第11章 MySQL支持的数据类型`

![](http://cdn.this0.com/blog/img/1681670916934-a11527aa-bf8f-43b8-8d4a-c50f4b5fb482.png?OSSAccessKeyId=LTAI5tAje5MhbPSKCC6QdGZb&Expires=9000000000&Signature=hX9PZVCN6Ubc6IC0vVD734zSRzg=&x-oss-process=style/cdn.this0)

`对于整数类型，MySQL还支持在类型名称后面加小括号(M)，而小括号中的M表示显示宽度，M的取值范围是(0, 255)。int(M)这个M在字段的属性中指定了unsigned（无符号）和zerofill（零填充）的情况下才有意义。表示当整数值不够M位时，用0填充。`

`如果整数值超过M位但是没有超过当前数据类型的范围时，就按照实际位数存储。当M宽度超过当前数据类型可存储数值范围的最大宽度时，也是以实际存储范围为准。那有什么用？？`

MySQL8之前，int没有指定(M)，默认显示(11)。最多能存储和显示11位整数。

##### 2、bit类型

bit类型，如果没有指定(M)，`默认是1位。这个1位，那么表示只能存1位的二进制值。这里(M)是表示二进制的位数。M范围从1到64。`

`对于位类型字段，之前版本直接使用SELECT语句将不会看到结果，而在MySQL8版本中默认以“0X”开头的十六进制形式显示，可以通过BIN()函数显示为二进制格式。`
`#显示二进制值，需要使用bin函数`

`3、小数类型`

CHAR(M)为固定长度的字符串， M表示最多能存储的字符数，取值范围是0~255个字符，`如果未指定(M)表示只能存储1个字符`。例如CHAR(4)定义了一个固定长度的字符串列，其包含的字符个数最大为4，如果存储的值少于4个字符，`右侧将用空格填充以达到指定的长度，当查询显示CHAR值时，尾部的空格将被删掉。`

VARCHAR(M)为可变长度的字符串，M表示最多能存储的字符数，M的范围由最长的行的大小（通常是65535）和使用的字符集确定。例如utf8mb4字符编码单个字符所需最长字节值为4个字节，所以M的范围是[0, 16383]。

`而VARCHAR类型的字段实际占用的空间为字符串的实际长度加1或2个字节，这1或2个字节用于描述字符串值的实际字节数，即字符串值在[0,255]个字节范围内，那么额外增加1个字节，否则需要额外增加2个字节。`

另外，`存储引擎对于选择CHAR和VARCHAR是有影响的。`

- `对于MyISAM存储引擎，最好使用固定长度的数据列代替可变长度的数据列。这样可以使整个表静态化，从而使数据检索更快，用空间换时间。`
- `对于InnoDB存储引擎，使用可变长度的数据列，因为InnoDB数据表的存储格式不分固定长度和可变长度，因此使用CHAR不一定比使用VARCHAR更好，但由于VARCHAR是按照实际的长度存储的，比较节省空间，所以对磁盘I/O和数据存储总量比较好。`

##### `2、Enum和Set类型`

无论是数值类型、日期类型、普通的文本类型，可取值的范围都非常大，但是有时候我们指定在固定的几个值范围内选择一个或多个，那么就需要使用ENUM枚举类型和SET集合类型了。比如性别只有“男”或“女”；上下班交通方式可以有“地铁”、“公交”、“出租车”、“自行车”、“步行”等。枚举和集合类型字段声明的语法格式如下：

字段名ENUM（‘值1’，‘值2’，…‘值n’）

字段名 SET（‘值1’，‘值2’，…‘值n’）

ENUM类型的字段在赋值时，只能在指定的枚举列表中取值，而且一次只能取一个。枚举列表最多可以有65535个成员。ENUM值在内部用整数表示，每个枚举值均有一个索引值， MySQL存储的就是这个索引编号。例如，定义ENUM类型的列(‘first’, ‘second’, ‘third’)。![image-20211127211743925.png](http://cdn.this0.com/blog/img/1681671223751-7b36d37a-9938-4647-84b7-f77c7d0b8fc2.png?OSSAccessKeyId=LTAI5tAje5MhbPSKCC6QdGZb&Expires=9000000001&Signature=rDA8HZBBqQgWY9augWsOW0jZE50=&x-oss-process=style/cdn.this0)

SET类型的字段在赋值时，可从定义的值列表中选择1个或多个值的组合。SET列最多可以有64个成员。SET值在内部也用整数表示，分别是1，2，4，8……，都是2的n次方值，因为这些整数值对应的二进制都是只有1位是1，其余是0。	（有什么用）![image-20211127211806889.png](http://cdn.this0.com/blog/img/1681671238035-342fcabd-9faa-4244-bb61-ae9605d45c41.png?OSSAccessKeyId=LTAI5tAje5MhbPSKCC6QdGZb&Expires=9000000001&Signature=gm8lJp4HLoivy/YTIrLAPTMAgb4=&x-oss-process=style/cdn.this0)

3、BINARY和VARBINARY类型

`4、二进制字符串和文本字符串`

`5、BLOB和TEXT类型`

命令行客户端的编码默认是GBK，而服务器端t_binary表的编码是“utf8mb4”

`5、BLOB和TEXT类型`

### DDl

3.查看某个数据库的详细定义语句

show create database 数据库名;

##### `4.修改数据库编码`

```
#修改数据库字符集和校对规则
ALTER DATABASE 数据库名称 CHARACTER SET 字符集名称 COLLATE 字符集对应校对规则;
```

```
ALTER DATABASE atguigu_chapter3_two CHARACTER SET utf8 COLLATE utf8_general_ci;
```

`**注意，**修改数据库编码只会影响之后创建的表的默认编码，之前创建的表不会受影响。`

##### 4.修改数据表编码

//TODO

`10.修改表结构：修改字段的数据类型`

alter table 表名称 modify 【column】 字段名称 新的数据类型;

##### 11.修改表结构：修改字段的名称

alter table 表名称 change 【column】 旧字段名称 新的字段名称 新的数据类型;

##### `12.修改表结构：修改字段位置`

alter table 表名称 modify 【column】 字段名称 数据类型 first;
alter table 表名称 modify 【column】 字段名称 数据类型 after 另一个字段;

##### 2.删除整张表的数据，但表结构留下

```
delete from 表名称;
```

```
delete from teacher;
```

##### 3.截断表，清空表中的数据，只有表结构

truncate 表名称;

##### （1）复制表结构

`#仅仅是复制表结构，可以用create语句`
`CREATE TABLE department LIKE t_department;`

##### （3）同时复制表结构和记录

`#同时复制表结构+数据`
`CREATE TABLE d_department AS (SELECT * FROM t_department);`
`#如果select后面是部分字段，复制的新表就只有这一部分字段`

`数据的完整性要从以下四个方面考虑：`

- `实体完整性（Entity Integrity）`：例如，同一个表中，不能存在两条完全相同无法区分的记录
- `域完整性（Domain Integrity）`：例如：年龄范围0-120，性别范围“男/女”
- `引用完整性（Referential Integrity）`：例如：员工所在部门，在部门表中要能找到这个部门
- `用户自定义完整性（User-defined Integrity）`：例如：用户名唯一、密码不能为空等，本部门经理的工资不得高于本部门职工的平均工资的5倍。

### 约束

`数据的完整性要从以下四个方面考虑：`

- `实体完整性（Entity Integrity）`：例如，同一个表中，不能存在两条完全相同无法区分的记录

- `域完整性（Domain Integrity）`：例如：年龄范围0-120，性别范围“男/女”

- `引用完整性（Referential Integrity）`：例如：员工所在部门，在部门表中要能找到这个部门

- `用户自定义完整性（User-defined Integrity）`：例如：用户名唯一、密码不能为空等，本部门经理的工资不得高于本部门职工的平均工资的5倍。

  

`所有的表级约束都可以在“information_schema.table_constraints”表中查看。`

在MySQL中`键约束会自动创建索引，提高查询效率。索引的详细讲解在高级部分.`

`约束是一个逻辑概念，它不会单独占用物理空间，`

`索引是一个物理概念，它是会占用物理空间。`

非空

alter table 表名称 modify 【column】 字段名 数据类型 not null;

//TODO和前面的modify整合一下

#### unique key

（5）删除唯一键约束的索引来删除唯一键约束
`索引名默认是字段名，复合唯一默认是第一个字段名。`

#如何在建表后添加唯一键约束
alter table 表名称 add unique 【key】(字段名);

##### .如何查看唯一键约束？（了解）

```
desc 表名称;

show create table 表名称;

show index from 表名称; #查看表的索引信息
```

create table 表名称(
字段名  数据类型,
字段名  数据类型,  
字段名  数据类型,
unique key(字段列表) #字段列表中写的是多个字段名，多个字段名用逗号分隔，表示那是`复合唯一，即多个字段的组合是唯一的`);

如果主键是由多列组成，可以使用复合主键

`说明：默认值约束一般不在唯一键和主键列上加`，因为要求是唯一的

alter table 表名称 modify 字段名 数据类型 default 默认值;

#如果这个字段原来有非空约束，你还保留非空约束，那么在加默认值约束时，还得保留非空约束，否则非空约束就被删除了

### 自增字段

（1）一个表只能有一个自增字段，因为一个表只有一个AUTO_INCREMENT属性记录自增字段值
（2）并且自增字段只能是key字段，即定义了主键、唯一键等键约束的字段。
一般都是给主键和唯一键加自增。
（3）自增字段应该是数值类型，一般都是整数类型。
（4）AUTO_INCREMENT属性值 必须 > 当前自增字段的最大值
（5）如果自增列指定了 0 和 null，会在当前最大值的基础上自增，
如果自增列手动指定了具体值，直接赋值为具体值。

